<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>UCD Course Prerequisite Network</title>
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
</head>
<body>

<h2>UCD Course Prerequisite Network</h2>

<input id="course" placeholder="Enter course ID (e.g. EAE126)">
<button onclick="loadCourse()">Load</button>

<div id="cy" style="width: 100%; height: 600px; border: 1px solid #ccc;"></div>

<script>
let cyInstance = null;

async function loadCourse() {
    const id = document.getElementById("course").value.trim();
    if (!id) return alert("请输入课程ID");

    // 改成你 Render 后端的 API
    const url = `https://sta160web.onrender.com/graph/${id}`;

    let data;
    try {
        data = await fetch(url).then(res => res.json());
    } catch (err) {
        return alert("无法获取数据，请检查后端服务是否运行");
    }

    let elements = [];

    data.nodes.forEach(n => {
        elements.push({
            data: { id: n.id, label: n.label }
        });
    });

    data.links.forEach(e => {
        elements.push({
            data: { source: e.source, target: e.target }
        });
    });

    if (cyInstance) {
        cyInstance.destroy();
    }

    cyInstance = cytoscape({
        container: document.getElementById('cy'),
        elements,
        layout: { name: 'breadthfirst', directed: true, spacingFactor: 1.5 },
        style: [
            {
                selector: 'node',
                style: {
                    'label': 'data(label)',
                    'text-valign': 'center',
                    'color': '#000',
                    'background-color': '#4dabf7',
                    'width': 30,
                    'height': 30,
                    'font-size': 12,
                }
            },
            {
                selector: 'edge',
                style: {
                    'width': 2,
                    'line-color': '#ccc',
                    'target-arrow-color': '#ccc',
                    'target-arrow-shape': 'triangle',
                    'curve-style': 'bezier'
                }
            }
        ]
    });

    // 点击节点可以重新加载该节点的子图
    cyInstance.on('tap', 'node', function(evt){
        const nodeId = evt.target.id();
        document.getElementById("course").value = nodeId;
        loadCourse();
    });
}
</script>

</body>
</html>
